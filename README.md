# Gemini Watermark Remover

Python tool to remove visible watermark of images generated by Nano Banana (Gemini's AI image generator)

## How it works

Gemini applies visible watermarks using **alpha blending**:

```text
watermarked = α × logo + (1 - α) × original
```

To remove the watermark, we reverse the formula:

```text
original = (watermarked - α × logo) / (1 - α)
```

This mathematical inversion produces exact restoration of original pixels.

## Installation

### Prerequisites

- Python 3.11+
- [uv](https://github.com/astral-sh/uv) (fast Python package manager)

### Install with uv

```bash
# Install uv (if not already installed)
pip install uv

# Create virtual environment and install dependencies
uv sync
```

This will create a `.venv` directory and install:

- `opencv-python` - Image I/O and pixel operations
- `numpy` - Numerical computations

### Or install with pip

```bash
pip install opencv-python numpy
```

## Quick start

### Basic usage

```bash
# Remove watermark (creates input_nowatermark.png)
uv run remove_watermark.py input.png
# or
python remove_watermark.py input.png

# Specify output file
uv run remove_watermark.py input.png --out clean.png
# or
# python remove_watermark.py input.png --out clean.png

# Specify output directory
uv run remove_watermark.py input.png --out output/
```

### Process multiple files

```bash
# Process multiple files (creates input1_nowatermark.png and input2_nowatermark.png)
uv run remove_watermark.py input1.png input2.png

# Process multiple files to a specific directory
uv run remove_watermark.py input1.png input2.png --out output/

# Note: With multiple files, --out must be an existing directory
# This will ERROR:
uv run remove_watermark.py input1.png input2.png --out result.png
```

### Force watermark size

```bash
# Force 48x48 watermark (for small images)
uv run remove_watermark.py input.png --force-small

# Force 96x96 watermark (for large images)
uv run remove_watermark.py input.png --force-large
```

### Force watermark removal

The tool automatically detects if a watermark is present. If no watermark is detected, the image is left unchanged:

```bash
# This will detect the watermark and only process if found
uv run remove_watermark.py input.png

# Force removal even if no watermark is detected
uv run remove_watermark.py input.png --force-remove
```

## Watermark size detection

The tool automatically detects the appropriate watermark size:

| Image Size                | Watermark | Position                  |
| ------------------------- | --------- | ------------------------- |
| W ≤ 1024 **or** H ≤ 1024  | 48×48     | Bottom-right, 32px margin |
| W > 1024 **and** H > 1024 | 96×96     | Bottom-right, 64px margin |

## Project structure

```text
gemini-watermark-remover/
├── README.md                 # This file
├── remove_watermark.py       # Main script to remove watermarks
├── watermark_48x48.bin       # 48x48 watermark data
└── watermark_96x96.bin       # 96x96 watermark data
```

## Build

```bash
uv run python -m nuitka --standalone --onefile --follow-imports --windows-console-mode=force --include-data-files=watermark_48x48.bin=watermark_48x48.bin --include-data-files=watermark_96x96.bin=watermark_96x96.bin --include-package=cv2 remove_watermark.py
```

## Limitations

- Only removes **Gemini visible watermarks** (the semi-transparent logo in bottom-right)
- Does **NOT** remove **SynthID invisible watermarks** (these are embedded during generation)
- Designed for Gemini's current watermark pattern (as of 2025)
- Watermark detection uses template matching; detection may fail on heavily modified images
